name: PM Audits
on: [pull_request]
jobs:
  lighthouse:
    runs-on: ubuntu-latest
    name: Lighthouse
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
      - name: wait for netlify
        uses: kamranayub/wait-for-netlify-action@2.0.0
        id: netflify
        with:
          site_name: hugo-template
        env:
          NETLIFY_TOKEN: ${{ secrets.NETLIFY_TOKEN }}
      - run: npm install @lhci/cli@0.4.x
      - run: lhci autorun --serverBaseUrl=${{ steps.netflify.outputs.url }}

  links:
    runs-on: ubuntu-latest
    name: Links
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
      - name: wait for netlify
        uses: kamranayub/wait-for-netlify-action@2.0.0
        id: netflify
        with:
          site_name: hugo-template
        env:
          NETLIFY_TOKEN: ${{ secrets.NETLIFY_TOKEN }}
      - run: npm install hyperlink tap-dot
      - run: node_modules/.bin/hyperlink ${{ steps.netflify.outputs.url }} -r | tee site.tap | node_modules/.bin/tap-dot

  a11y:
    runs-on: ubuntu-latest
    name: Accessibility
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
      - name: wait for netlify
        uses: kamranayub/wait-for-netlify-action@2.0.0
        id: netflify
        with:
          site_name: "hugo-template"
        env:
          NETLIFY_TOKEN: ${{ secrets.NETLIFY_TOKEN }}
      - run: npm install pa11y
      - run: node_modules/.bin/pa11y ${{ steps.netflify.outputs.url }}
